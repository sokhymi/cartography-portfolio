<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Coastal eutrophication in Europe</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;600;800&display=swap"
      rel="stylesheet"
    />

    <style>
      /* --- REPORT THEME --- */
      :root {
        --primary-green: #03a010;
        --dark-green: #014607;
        --text-grey: #5c5c5c;
        --bg-color: #f4f7f4;
        --card-bg: #ffffff;
      }

      body {
        margin: 0;
        padding: 0;
        font-family: "Manrope", sans-serif;
        background-color: var(--bg-color);
        color: var(--text-grey);
        -webkit-font-smoothing: antialiased;
      }

      header {
        background-color: var(--card-bg);
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        padding: 20px 40px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.02);
      }

      .logo {
        font-weight: 800;
        font-size: 1.2rem;
        color: var(--dark-green);
        letter-spacing: -0.5px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .logo-icon {
        width: 12px;
        height: 12px;
        background-color: var(--primary-green);
        border-radius: 50%;
        display: inline-block;
      }

      .report-container {
        max-width: 1200px;
        margin: 40px auto;
        padding: 0 20px;
      }

      .report-card {
        background: var(--card-bg);
        border-radius: 16px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.04);
        padding: 60px;
        overflow: hidden;
      }

      h1 {
        font-weight: 800;
        color: var(--dark-green);
        margin-top: 0;
        font-size: 2.5rem;
        letter-spacing: -1px;
        text-align: center;
      }

      h2 {
        font-weight: 600;
        color: var(--primary-green);
        margin-top: 0;
        font-size: 1.75rem;
        letter-spacing: -1px;
        text-align: center;
      }

      .subtitle {
        text-align: left;
        font-size: 1.1rem;
        max-width: 700px;
        margin: 0 auto 40px auto;
        line-height: 1.6;
        color: #7a7a7a;
      }

      /* --- MAP WRAPPER --- */
      .map-wrapper {
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 40px 0;
        background-color: #f9fbf9;
        border-radius: 12px;
        border: 1px solid rgba(0, 0, 0, 0.05);
        padding: 20px;
        overflow-x: auto; /* Allows scrolling if map is wider than screen */
      }

      iframe {
        border: none;
        width: 1000px; /* Matching your map's inline width */
        height: 520px; /* Slightly taller than map height to prevent scrollbars */
        border-radius: 8px;
      }

      .report-meta {
        margin-top: 40px;
        padding-top: 20px;
        border-top: 1px solid #eee;
        display: flex;
        justify-content: space-between;
        font-size: 0.9rem;
      }

      .badge {
        background-color: #e6f4e7;
        color: var(--dark-green);
        padding: 4px 12px;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.8rem;
      }
    </style>
  </head>
  <body>
    <header>
      <img
        src="sdg14.png"
        alt="SDG: 14"
        width="50px"
        height="50px"
        align="center"
      />
      <div class="logo">Sustainable Development Goals 14: Life Below Water</div>
      <div style="font-weight: 600; font-size: 0.9rem">Bilegjargal Bold</div>
    </header>

    <main class="report-container">
      <div class="report-card">
        <span class="badge" style="display: table; margin: 0 auto 20px auto"
          >End-of-semester portfolio for class Advanced Cartography</span
        >
        <h1>Coastal nitrogen pollution in Europe</h1>
        <h2>Basis</h2>

        <p class="subtitle">
          Nitrogen is a major constituent of coastal eutrophication and when
          uncontrolled, causes harmful algal blooms (HABs) to accumulate.
          Sustainable Development Goal 14 seeks to onserve and sustainably use
          the oceans, seas and marine resources for sustainable development.
        </p>
        <h2>Initial map</h2>
        <p class="subtitle">
          The initial map created using QGIS turned out as depicted below.
          Possible critique included the consideration of "inland" borders
          (where algal bloom concentrations are low as opposed to the oceans),
          which was removed in the later Leaflet webmap. <br /><br />

          The second cartographic issue that was recognized was the use of the
          color red: while it does imply negative developments, it does not
          relate to the problem at hand; algal blooms are associated with
          stronger green colors in reality.
        </p>

        <center>
          <img
            src="qgis_map.png"
            alt="Initial map made with QGIS"
            width="705"
            ,
            height="500"
            ,
            border="2"
          />
        </center>
        <br />

        <h2>Eye-tracking study with RealEye(s realize real lies)</h2>
        <p class="subtitle">
          The eye-tracking study with RealEye yielded the following heatmap. The
          concentration on Europe and its higher values was expected of the
          map.<br /><br />

          An issue with the map highlighted by the eye movements indicate that
          the projection, albeit Europe-oriented, served as a distraction due to
          North America and South America taking on unusual shapes that
          unnecessarily drew attention away from the main message of the map.
        </p>

        <center>
          <img
            src="heatmap.png"
            alt="Eye-tracking study with RealEye"
            width="705"
            ,
            height="500"
            ,
            border="2"
          />
        </center>
        <br />

        <p class="subtitle">
          Due to the nature of eutrophication, a "naturally green" phenomenon,
          the red colors were converted to green, and the choropleth nature of the map
          was changed to signify that eutrophication <strong>only</strong> happens in coastal areas.
      </p>

        <h2>Interactive Leaflet map of coastal areas</h2>

        <p class="subtitle">
          The following Leaflet map details the concentration of nitrogen in
          coastal waters (mcmol/liter²), again by country. Hover on coastal
          areas to see the concentration levels in mcmol/liter² (in accordance
          with the data provided by the UN) or click on a country to see the
          state of nitrogen pollution, by state.
        </p>

        <div class="map-wrapper">
          <iframe id="report-map-frame" title="Map Visualization"></iframe>
        </div>

        <div class="report-meta">
          <div></div>
          <div style="text-align: right">
            <strong>Data availability:</strong> 16 countries in Europe. <br />
            Data is aggregated by country: more precise <br />coordinates by
            measurement station may be required.
          </div>
        </div>
      </div>
    </main>

    <textarea id="user-provided-code" style="display: none">
<!doctype html>
<html lang="en">
  <head>
    <base target="_top" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Coastal eutrophication by country</title>

    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="docs/images/favicon.ico"
    />

    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Manrope:wght@200..800&display=swap"
      rel="stylesheet"
    />
    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>

    <style>
      html,
      body {
        height: 100%;
        margin: 0;
      }
      .leaflet-container {
        height: 400px;
        width: 600px;
        max-width: 100%;
        max-height: 100%;
      }
    </style>

    <style>
      #map {
        width: 800px;
        height: 500px;
      }
      .info {
        padding: 6px 8px;
        background: rgba(255, 255, 255, 0.8);
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
        border-radius: 5px;
      }
      .info h4 {
        margin: 0 0 5px;
        color: #5c5c5c;
        font-family: "Manrope", sans-serif;
      }

      .info b {
        font-family: "Manrope", sans-serif;
      }

      .legend {
        text-align: left;
        line-height: 18px;
        color: #555;
      }
      .legend i {
        width: 18px;
        height: 18px;
        float: left;
        margin-right: 8px;
        opacity: 0.7;
      }
      .map-title {
        background: rgba(255, 255, 255, 0.8);
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
        padding: 10px;
        border-radius: 5px;
        font-weight: bold;
        font-size: 20px;
        font-family: "Manrope", sans-serif;
        color: #5c5c5c;
      }

      .details {
        padding: 6px 8px;
        background: rgba(255, 255, 255, 0.8);
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
        border-radius: 5px;
      }
      .details h4 {
        margin: 0 0 5px;
        color: #5c5c5c;
        font-family: "Manrope", sans-serif;
      }

      .details-panel {
        width: 257px;
        max-width: 100%;
        max-height: 400px;
        overflow-y: auto;
      }
    </style>
  </head>
  <body>
    <div id="map" style="width: 1000px; height: 100%"></div>
    <script>
      let geoLayer;

      const map = L.map("map", {
        zoomSnap: 0.5,
      }).setView([53.818113518906195, 2.88607961393051], 3.5);

      const tiles = L.tileLayer(
        "https://api.mapbox.com/styles/v1/sokhymera/cky2jymkf0ta114kymd5a2wk9/tiles/{tileSize}/{z}/{x}/{y}?access_token=pk.eyJ1Ijoic29raHltZXJhIiwiYSI6ImNtajhpZm03OTAwazkzaXIzb2NjMWpzeTYifQ.rXpcYv8_7Fx9aNhyWEN6SA",
        {
          maxZoom: 19,
          attribution: '&copy; <a href="https://mapbox.com">Mapbox</a>',
        },
      ).addTo(map);

      const info = L.control();

      info.onAdd = function (map) {
        this._div = L.DomUtil.create("div", "info");
        this.update();
        return this._div;
      };

      info.update = function (props) {
        const contents = props
          ? `<b>${props.NAME_ENGL}</b><br />${props.Amount.toString().substring(0, 7)} mcmol / liter<sup>2</sup>`
          : "Hover over a coastal area";
        this._div.innerHTML = `<h4>Coastal nitrogen concentration</h4>${contents}`;
      };

      info.addTo(map);

      function getColor(d) {
        return d > 6500
          ? "#05FA19"
          : d > 2000
            ? "#04CD15"
            : d > 1000
              ? "#03A010"
              : d > 500
                ? "#02730C"
                : d > 100
                  ? "#014607"
                  : "#011903";
      }

      function style(feature) {
        return {
          weight: 2,
          opacity: 1,
          color: getColor(feature.properties.Amount),
          fillOpacity: 0.7,
        };
      }

      function highlightFeature(e) {
        const layer = e.target;

        layer.setStyle({
          weight: 5,
          color: "#FFFD00",
          dashArray: "",
          fillOpacity: 0.7,
        });

        layer.bringToFront();

        info.update(layer.feature.properties);
      }

      async function loadData() {
        try {
          const response = await fetch(
            "eutrophication_lines1_buffer_difference3.geojson",
          );
          const geojsonData = await response.json();

          geoLayer = L.geoJSON(geojsonData, {
            style: style,
            onEachFeature,
          }).addTo(map);
        } catch (error) {
          console.error("Error loading the GeoJSON file:", error);
        }
      }

      loadData();

      function resetHighlight(e) {
        geoLayer.resetStyle(e.target);
        info.update();
      }

      function zoomToFeature(e) {
        const layer = e.target;
        map.fitBounds(layer.getBounds());
        details.update(layer.feature.properties);
      }

      function onEachFeature(feature, layer) {
        layer.on({
          mouseover: highlightFeature,
          mouseout: resetHighlight,
          click: zoomToFeature,
        });
      }

      var legend = L.control({ position: "bottomright" });

      legend.onAdd = function (map) {
        var div = L.DomUtil.create("div", "info legend"),
          grades = [0, 100, 500, 1000, 2000, 6500],
          labels = [];

        div.innerHTML = '<h4>mcmol/liter²</h4>';
        // loop through our density intervals and generate a label with a colored square for each interval
        for (var i = 0; i < grades.length; i++) {
          div.innerHTML +=
            '<i style="background:' +
            getColor(grades[i] + 1) +
            '"></i> ' +
            grades[i] +
            (grades[i + 1] ? "&ndash;" + grades[i + 1] + "<br>" : "+");
        }

        return div;
      };

      legend.addTo(map);

      var title = L.control({ position: "bottomleft" });

      title.onAdd = function (map) {
        var div = L.DomUtil.create("div", "map-title");
        div.innerHTML = "Coastal nitrogen pollution";
        return div;
      };

      title.addTo(map);

      const details = L.control({ position: "bottomleft" });

      details.onAdd = function (map) {
        this._div = L.DomUtil.create("div", "info details-panel");
        this.update();
        return this._div;
      };

      details.update = function (props) {
        const contents = props
          ? `<b>${props.NAME_ENGL}</b><br />${props.CountrySpecificText}`
          : "Click on a coastal area";
        this._div.innerHTML = `<h4>Country details</h4>${contents}`;
      };

      details.addTo(map);
    </script>
  </body>
</html>
    </textarea>

    <script>
      const userCode = document.getElementById("user-provided-code").value;
      const iframe = document.getElementById("report-map-frame");
      iframe.srcdoc = userCode;
    </script>
  </body>
</html>
